{{
  config(
  materialized='table'  
  )
}}
WITH CUSTOMER_DET AS
(
SELECT
C_CUSTKEY,
C_ADDRESS,
C_NATIONKEY 
FROM CUSTOMERS),
OREDER_DET AS
(
 SELECT 
 O_CUSTKEY,
 O_ORDERSTATUS,
 O_ORDERDATE,
 O_TOTALPRICE
FROM ORDERS) ,
NATION_DET AS 
(
SELECT 
N_NATIONKEY,
N_NAME 
FROM NATIONS),
CUST_ORDER_SUMMARY
AS
(
SELECT
C_CUSTKEY,
C_ADDRESS,
N_NAME ,
O_ORDERSTATUS,
SUM(O_TOTALPRICE) TOTALPRICE
FROM 
CUSTOMER_DET , 
OREDER_DET , 
NATION_DET 
WHERE 
C_CUSTKEY=O_CUSTKEY AND
C_NATIONKEY=N_NATIONKEY
GROUP BY C_CUSTKEY,
C_ADDRESS,
N_NAME ,
O_ORDERSTATUS)
SELECT * FROM CUST_ORDER_SUMMARY